<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>

	<div class="posts">
		
	</div>

	
	<script>


		function renderPosts(){

			let elPosts = document.querySelector(".posts");
			elPosts.innerHTML = "";
			let posts = JSON.parse(this.response);


			posts.forEach((post)=>{
				elPosts.innerHTML += `<div><h2>${post.title}</h2><p>${post.text}</p><button type="button" data-value="${post.id}">Удалить</button></div>`;
			})

			let elButtons = document.querySelectorAll("button");

			elButtons.forEach((button)=>{
	
				button.addEventListener("click", (evt)=>{
					let idPost = evt.target.getAttribute("data-value");
					
					request("POST", "http://127.0.0.1:8000/api/post-delete", renderPosts, "id="+idPost);
				})
			});

			
		}

		function request(method, url, callback, params = null){
			const req = new XMLHttpRequest();
			req.addEventListener("load", callback.bind(req));
			req.open(method, url, true);
			req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			req.send(params);
		}

		request("GET", "http://127.0.0.1:8000/api/posts", renderPosts);

		
		
	</script>
</body>
</html>	